# **ğŸ“˜ Bases de Datos y Eloquent ORM**

#### ğŸ—“ï¸ Semana 5: **â€œDel Papel al CÃ³digo: Modelando Datos con Laravelâ€**

### ğŸ¯ Objetivos de Aprendizaje

1. **Configurar y gestionar conexiones de bases de datos en Laravel 12**, utilizando XAMPP y Visual Studio Code como herramientas principales.
2. **Aplicar migraciones, seeders y modelos Eloquent** para estructurar y poblar bases de datos, facilitando el desarrollo de aplicaciones web robustas.

### ğŸ“ PropÃ³sito de la Actividad

Al finalizar esta semana, los estudiantes serÃ¡n capaces de:

- Configurar adecuadamente el entorno de desarrollo con Laravel 12, XAMPP y Visual Studio Code.
- Crear y ejecutar migraciones y seeders para definir y poblar esquemas de bases de datos.
- Desarrollar modelos Eloquent para interactuar con las bases de datos de manera eficiente.

Este conocimiento es fundamental para construir aplicaciones web dinÃ¡micas que requieran almacenamiento y manipulaciÃ³n de datos persistentes.

## ğŸ“˜ Conceptos Clave con Ejemplos

### ğŸ”Œ 1. ConfiguraciÃ³n de Base de Datos en Laravel

Laravel permite conectar fÃ¡cilmente con bases de datos como MySQL usando variables en el archivo `.env`.

ğŸ“„ **Archivo `.env`**

```bash
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=nombre_base_de_datos
DB_USERNAME=root
DB_PASSWORD=
```

ğŸ” *Este archivo actÃºa como el â€œpuenteâ€ entre tu cÃ³digo y la base de datos.*

ğŸ‘©â€ğŸ’» **Ejemplo real**: Si estÃ¡s creando una app de reservas de citas mÃ©dicas, aquÃ­ definirÃ­as la base de datos `clinica_db` que usarÃ¡ Laravel para almacenar usuarios, mÃ©dicos, y citas.

### ğŸ› ï¸ 2. Migraciones

Las migraciones son como planos ğŸ“ de las tablas que vamos a crear en nuestra base de datos. Son Ãºtiles para mantener un historial de los cambios en la estructura.

ğŸ“¦ **Ejemplo**

```bash
php artisan make:migration create_appointments_table
```

ğŸ” Esto crea un archivo donde defines las columnas de la tabla `appointments` como si diseÃ±aras la maqueta de una mesa en un taller de carpinterÃ­a.

ğŸ“„ MigraciÃ³n simple:

```php
Schema::create('appointments', function (Blueprint $table) {
    $table->id();
    $table->string('patient_name');
    $table->timestamp('appointment_date');
    $table->timestamps();
});
```

ğŸ§  *Ventaja:* Si trabajas en equipo, todos pueden aplicar los mismos cambios ejecutando `php artisan migrate`.

### ğŸŒ± 3. Seeds (Semillas)

Los **seeds** permiten poblar la base de datos automÃ¡ticamente con datos de prueba ğŸ§ª.

ğŸ“¦ **Ejemplo**

```php
php artisan make:seeder UsersTableSeeder
```

ğŸ“„ En el archivo generado puedes hacer:

```bash
DB::table('users')->insert([
    'name' => 'Juan PÃ©rez',
    'email' => 'juan@example.com',
    'password' => bcrypt('123456')
]);
```

ğŸ¯ *Usos prÃ¡cticos:* Ideal para probar funcionalidades como login sin tener que llenar formularios manualmente.

### ğŸ§  4. Eloquent ORM

Eloquent es el **motor de Laravel para trabajar con bases de datos** usando PHP orientado a objetos ğŸ’¡.

ğŸ“„ Crear un modelo:

```bash
php artisan make:model Appointment
```

ğŸ”„ **Relaciones**

Eloquent permite definir relaciones como:

```bash
// En Doctor.php
public function appointments() {
    return $this->hasMany(Appointment::class);
}

// En Appointment.php
public function doctor() {
    return $this->belongsTo(Doctor::class);
}
```

ğŸ” *Ejemplo real:* En una tienda online ğŸ›’, una categorÃ­a puede tener muchos productos (`hasMany`), y cada producto pertenece a una categorÃ­a (`belongsTo`).



# **ğŸ” Â¿QuÃ© es Eloquent?**

âœ¨ **Eloquent** es el **ORM (Object-Relational Mapping)** de Laravel.

Significa que te permite **trabajar con bases de datos usando objetos PHP** en lugar de escribir directamente consultas SQL.

ğŸ” Traduce las **tablas** de tu base de datos en **clases PHP**, y las **filas** en **objetos**.

AsÃ­ puedes hacer cosas como:

```bash
User::find(1);
```

en lugar de:

```sql
SELECT * FROM users WHERE id = 1;
```

## ğŸ—ï¸ Estructura de Eloquent

1. ğŸ“„ **Modelo** = Representa una tabla (Ej: `Post`)
2. ğŸ—‚ï¸ **Propiedades** = Columnas de la tabla (`title`, `content`, `created_at`)
3. ğŸ” **Relaciones** = Conecta modelos entre sÃ­ (`hasMany`, `belongsTo`)
4. ğŸ“¦ **MÃ©todos** = Obtener, insertar, actualizar y borrar datos con facilidad

## ğŸ§‘â€ğŸ« CÃ³mo se usa Eloquent: Paso a Paso

### ğŸ§± 1. Crear un modelo

```bash
php artisan make:model Post
```

Esto genera:

ğŸ“„ `app/Models/Post.php`

ğŸ” Laravel espera que exista una tabla `posts` en la base de datos

### âœï¸ 2. Ejemplo bÃ¡sico de un modelo

```php
namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Post extends Model
{
    // AquÃ­ puedes definir relaciones, columnas protegidas, etc.
}
```

### ğŸ” 3. Consultas comunes con Eloquent

#### âœ… Obtener todos los registros

```php
$posts = Post::all(); // SELECT * FROM posts;
```

#### ğŸ” Buscar por ID

```php
$post = Post::find(1); // SELECT * FROM posts WHERE id = 1;
```

#### ğŸ” Buscar por condiciÃ³n

```php
$posts = Post::where('category_id', 2)->get();
```

### ğŸ“ 4. Crear un nuevo registro

```php
$post = new Post();
$post->title = "Nuevo artÃ­culo Laravel";
$post->content = "Contenido del artÃ­culo";
$post->save();
```

ğŸ’¡ TambiÃ©n puedes hacerlo en una sola lÃ­nea:

```php
Post::create([
    'title' => 'Aprendiendo Eloquent',
    'content' => 'Esto es muy sencillo ğŸš€'
]);
```

âš ï¸ AsegÃºrate de declarar las columnas que se pueden rellenar en el modelo:

```php
protected $fillable = ['title', 'content'];
```

### ğŸ”„ 5. Actualizar un registro

```php
$post = Post::find(1);
$post->title = "TÃ­tulo actualizado";
$post->save();
```

### âŒ 6. Eliminar un registro

```php
Post::destroy(1); // Elimina por ID
```

o

```php
$post = Post::find(1);
$post->delete(); // Elimina con objeto
```

## ğŸ”— Relaciones en Eloquent (Â¡Superpoderes! ğŸ¦¸)

### ğŸ“ Un post pertenece a una categorÃ­a (many to one)

```php
// En Post.php
public function category() {
    return $this->belongsTo(Category::class);
}
```

### ğŸ“‚ Una categorÃ­a tiene muchos posts (one to many)

```php
// En Category.php
public function posts() {
    return $this->hasMany(Post::class);
}
```

### ğŸ‘¥ Muchos a muchos: Productos y Pedidos

```php
// En Order.php
public function products() {
    return $this->belongsToMany(Product::class, 'order_items');
}
```

ğŸ” *Laravel incluso maneja automÃ¡ticamente tablas pivote, fechas de creaciÃ³n y sincronizaciÃ³n de relaciones.*

## ğŸ§  Beneficios de Eloquent

âœ¨ FÃ¡cil de usar y de leer

ğŸ”„ Automatiza relaciones

ğŸ›¡ï¸ Protege contra inyecciones SQL

ğŸ“š Compatible con migraciones y seeds

âš¡ Potente para proyectos pequeÃ±os y grandes

## ğŸ§¾ ConclusiÃ³n

ğŸ¯ **Eloquent** hace que interactuar con bases de datos sea tan natural como trabajar con arrays u objetos.

En lugar de pensar en "cÃ³mo hacer una consulta SQL", piensas en **cÃ³mo manipular objetos**.

Esto acelera el desarrollo y reduce errores.